<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="Grace Yen, Adobe System Corp.">
  
    <title>Prototype</title>
  
    <!-- For tooltip -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<script type="text/javascript" src="bootstrap-4.1.3-dist/js/bootstrap.bundle.min.js"></script>
	
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<!-- the link below is too slow -->
	<!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<!-- JQuery and Google font -->
    <link href='https://fonts.googleapis.com/css?family=Exo:100,400' rel='stylesheet' type='text/css'>
	<!-- Custom styles for this template -->
	<link href="css/bootstrap-slider.css" rel="stylesheet">

	<script src="dist/js/bootstrap-slider.js"></script>
	<script src="labeled.js"></script>

<style>
        .droptarget {
            float: left; 
	        width: 300px; 
	        height: 3500px;
	        margin: 15px;
	        padding: 10px;
	        border: 1px solid #aaaaaa;
   		}
    	mark{
    		background: orange;
    		color: black;
		}
		.idea-unit:hover {
			cursor: pointer;
			background-color: lightgray;
		}

		.visited { 
		    background-color: lightgrey;
		}

	
		.highlight{
			color: blue !important;;
		}

		.active-icon{
			color: red !important;
		}

.active-text{
	/*background-color: yellow !important;*/
	border: 4px solid grey;
}
.vis-content{
	text-align: justify; 
	padding-bottom:10px; 
	padding-right:25px;
}

p.success{
	color:green;
}
p.fail{
	color:red;
}

.original-feedback{
	margin: 10px;
	font-size: 20px;
}



.topic-row{
	text-align: center;
}

.topic-field{
	display: inline-block;
	font-weight: bold;
}

.tableelement {
	width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #dfe2de;
    cursor: pointer;
    margin: 3px;
}
table.topic-people{
	border: 0px;
}
table.topic-people td{
	padding-top: 2px;
	padding-right: 2px;
	padding-bottom: 2px;
	padding-left: 0px;
	border: 0;

}

.tableelement.selectElement{
	 box-shadow: 0 0 2pt 2pt grey; 
}

.human-figure{
	color:grey; font-size:32px; margin:6px
}

.tooltip-inner {
	max-width: 500px;
	font-size: 1rem;
}

</style>

</head>

<body>
<!--Consider set as element for django-->
<nav class="navbar navbar-fixed-top navbar-inverse" style="background:#002058">
        <div class="container">
            <div class="navbar-header">
               FeedbackPanel
            </div>  
        </div>
</nav>

<div style='display: none'>
	<span class='table-text'>
		Good to have a visual analytical data.</span>
	<span class='table-text'>
		Not the biggest fan of the team name, but it is still early. I like the idea especially for freshman students trying to meet new friends while eating their meals. I know personally that eating at Ikenberry Commons can be extremely fun if with a big group, but also very lonely if you have no one to eat with. I really like the fact that you can select restaurants around campus, however I feel that this is out of the scope of their idea.</span>
	<span class="table-text">I think it's a very interesting and practical idea. And the presentation is very informative and clear. Good job!
	</span>
	<span class='table-text'>Down to Lunch is pretty similar(http://imdtl.com), however I like you how you can create a check in time and see who else is planning on going. </span>

	<span class='table-text'>How will you match people who want to eat at a particular place? Will it be random? How will you handle situations where there are no other people interested in eating at the same restaurant as you? I think it would be important to incorporate some design decisions to emphasize the platonic nature of these meal dates. Meal dates where the people have different expectations might end up awkward or creepy.
</span>

	<span class='table-text'>I like the aspect of MealDate where users’ locations are public when they’re arranging to meet to ensure safety/security.  It would be cool to have features for people to look for people with common majors, interests, etc. to meal with.  That could be an additional feature for users specifically seeking these meal buddies to search for them.  Users can always not use this feature and go with meeting all kinds of people based on food joint choice only.
 </span>


		<span class='table-text'>Q: would this be a group meet up or a one-on-one? If it's just one-on-one, wouldn't this naturally evolve into a dating app? 
</span>
<span class='table-text'>"I like the idea of sketches, and it shows a creative touch to design, so this was a great way to start. I personally don't feel like I want to eat meals with somebody though...but I can definitely see this during some times, especially if I have been locked in and doing work for a while. Therefore, I think there is definitely a need here. Also, thank you for focusing on the platonic interaction here! You thought of quite a bit of the social awkwardness or limitations that come out of an activity like this, too. 

At first, my thoughts were that the scope is a bit too wide, but the use cases were very targeted and using the app would enforce the process you are going for here. I was also fearful that limiting to just college students might have been a bit of a small target audience, but you eased these fears quite a lot through explaining the feasibility and time you had here. I still am a bit confused by some of how the friending mechanism works if everything goes well, and whether or not you might get locked into certain habits that were not immediately intended (with friends here).

Moving pas this, though...my goodness, these prototypes. These are incredible, especially given the stage that you are presenting at. Maps are maps, and I get that, so that's a bit easier to add to these prototypes...but the interaction flow is well polished and supports an already strong idea. Well done! 

(One extra point, but I just wanted that I enjoyed your response to how people match based on description, taking away items that might enforce judging.)"

</span>

<span class='table-text'>The use of statistics to figure out the user problem was very well thought out and fleshed out.  There are a variety of app features which will make the app go a long way.  The white board drawings are very refreshing on the eyes to look at.
</span>

<span class='table-text'>Rating system could be hard to implement since the profiles are public and the two people might meet again, might be good to allow group of people to eat.</span>

<span class='table-text'>Good stats and data in visual.  
How are you planning to show when they want to go?  What about when a restaurant has multiple requests, how will you sort all the requests?  When does the user put in a meal date request/how far in advance to their meal?
What will you do with the people who don't know what or where they want to eat?  
Group vs individual meal dates</span>


<span class='table-text'>Purpose: Grouping people together to make them eat together. The idea is great and trying to solve a real problem. However, one problem is that it is sometimes hard to plan ahead for a lunch/dinner, such as which restaurant to go, or at what time do I go eat. Also the waiting time for the grouping up progress will be somehow hard to estimate.</span>

<span class='table-text'>Good idea, unsure what makes it unique. I like the UI layout so far. I can see some issues with safety when it comes to meeting strangers but I suppose that's inherent in a meet-up app.</span>



<span class='table-text'>"I like the idea, because it's a good way of meeting people in a non-dating setting. Especially in a college setting, but I could also easily see it expanding outside colleges. 
- On your front page you ask 'where to', like what restaurant I want to go to. What if I don't care so much about the restaurant, but I just want to have lunch with someone? 
- Groups of people meeting each other. How do you make sure it doesn't evolve into another dating app. 
- I would want to know who I'm meeting with before 'matching' i.e. I think a profile picture is definitely needed. "
</span>

<span class='table-text'>I like the idea of implementing security into the app. I would maybe add some more info about a person - types of food they like, interests, etc. How would you recognize your dinner date? If you include pics in the profile, it might become a dating app, but if you don't the meet up may be awkward.
</span>
<span class='table-text'>The app would have be frictionless as possible in order for users to use the app often. Also, there are a lot of people that order/buy take-outs instead of eating in at restaurants. What if you had a nice sandwich that you wanted to enjoy on the quad accompanied by a presence of another human being?
</span>
<span class='table-text'>
I like the idea and the simplicity of the prototype. I know you guys said that this was a 1 on 1 app but there are people who may not fell comfortable meeting strangers in a 1 on 1 setting. I think adding a group up feature where you can request to meet with multiple people instead of just 1 on 1.
</span>

</div>

<div id='page-1'>  
	<div class="container">
			<div class="main-section" style="margin-top: 50px">
		<div class="alert alert-info" role="alert" >
			<h4>Instruction</h4>
			 Please select values that make most sense to you blablabla. 
			<a type="button" class="btn btn-info" onclick='finishAnnoate();'>View My MindSpace</a>
		</div>
  		<nav aria-label="Page navigation example">
		  <ul class="pagination" id="page-list">
		  </ul>
		</nav>

		<div class="row" id='all_feedback_table'></div>

<template name='feedback_table'>
	<div class="annotate-panel" style='display:none;'>
	  <a class="btn btn-primary" data-toggle="collapse" href="" role="button" aria-expanded="false" >Read Origianl Feedback</a>

	<div class='collapse multi-collapse' name='original-feedback'></div>


	<table class='table table-hover table-nonfluid'>
		<thead>
		    <tr>
		      <th style="width:5%" scope="col">#</th>
		      <th style="width:30%" scope="col">Content</th>
		      <th style="width:5%" scope="col"></th>
		      <th style="width:10%" scope="col">Topic</th>
		      <th style="width:10%" scope="col">Sentiment</th>
		      <th style="width:10%" scope="col">Estimtated Effort</th>
		      <th style="width:10%" scope="col">Criticality</th>
		      <th style="width:10%" scope="col">Need Discussion</th>
		      <th style="width:10%" scope="col">Agree</th>
		    </tr>
		  </thead>
	
	<tbody id='ideaunits'>
		
	</tbody>
	</table>
	</div>

</template>

<template name='feedback-row-template'>
	<tr class='feedback-row'> 
		<th name='ideaid' scope='row'></th>
		<td name='content'></td>
		<td><button type="button" name='merge' class="btn btn-info">Merge</button></td>
		<td>
			<div class='topic-section1'>
				<span>Give a label</span>
				<input type='text' style='display: inline-block;' name='new-topic'>
				<!--<button class='add-btn' name='add-btn'><span class='fa fa-plus' style=" font-size:24px;margin-right:3px"></span></button>-->
				<p name='check-result'></p>
				<br><br>

				Select from existing labels
			<select name='topic' style="margin-bottom: 5px">
				<option>Select from... </option>
			</select>				
				
			
			
		</div>
		</td>

		<td><select name='sentiment'>
				<option></option>
				<option>strength</option>
				<option>weakness</option>
				<option>neutral</option>
			</select>
		</td>
		<td><select name='effort'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='criticality'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='discussion'>
				<option></option>
				<option>yes</option>
				<option>no</option>
		</td> 
		<td><select name='agree'>
			<option></option>
			<option>completely</option>
			<option>partially</option>
			<option>no</option>
		</td> 
	</tr>
	
</template>


<template name='feedback-row-template'>
	<tr class='feedback-row'> 
		<th name='ideaid' scope='row'></th>
		<td name='content'></td>
		<td><button type="button" name='merge' class="btn btn-info">Merge</button></td>
		<td>
			<div class='topic-section1'>
				<span>Give a label</span>
				<input type='text' style='display: inline-block;' name='new-topic'>
				<!--<button class='add-btn' name='add-btn'><span class='fa fa-plus' style=" font-size:24px;margin-right:3px"></span></button>-->
				<p name='check-result'></p>
				<br><br>

				Select from existing labels
			<select name='topic' style="margin-bottom: 5px">
				<option>Select from... </option>
			</select>				
				
			
			
		</div>
		</td>
		<td><select name='sentiment'>
				<option></option>
				<option>strength</option>
				<option>weakness</option>
				<option>neutral</option>
			</select>
		</td>
		<td><select name='effort'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='criticality'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='discussion'>
				<option></option>
				<option>yes</option>
				<option>no</option>
		</td> 
		<td><select name='agree'>
			<option></option>
			<option>completely</option>
			<option>partially</option>
			<option>no</option>
		</td> 
	</tr>
	
</template>


</div>
</div>

</div>
<!------Show All Feedback--------------------------------------------------->
<div id='all-feedback' style="display: none;">	
<div class="container-fluid">
	<div class="main-section" style="margin-top: 50px">

<div class="alert alert-info" role="alert" >
		<h4>Instruction</h4>
	 We collect six pieces of feedback from independent reviewers. The feedback set is categorized and transformed into a summary panel (on the right hand side). You can interact with the panel to explore the feedback set. 

	 <a type="button" class="btn btn-info" onclick='backAnnotate();'>Revise My Annotate</a>
	</div>
 

<ul class="nav nav-tabs">
  <li class="nav-item">
    <a class="nav-link active" style="cursor: pointer;" onclick="showAll();">All Feedback</a>
  </li>
    <li class="nav-item">
    <a class="nav-link " style="cursor: pointer;" onclick="filterFeedback();">Smart Review</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" href="#">Action Plan</a>
  </li>
</ul>


		<table class='table table-nonfluid'>
	<table class='table table-nonfluid'>
	<tbody id='feedback-list'>
	</tbody>
</table>
	</table>
	
	</div>
</div>

</div>
<!------End Show All Feedback--------------------------------------------------->

<div id='page-2' style="display: none;">


<div class="container-fluid">
	<div class="main-section" style="margin-top: 50px">


	<div class="alert alert-info" role="alert" >
		<h4>Instruction</h4>
	 We collect six pieces of feedback from independent reviewers. The feedback set is categorized and transformed into a summary panel (on the right hand side). You can interact with the panel to explore the feedback set. 

	 <a type="button" class="btn btn-info" onclick='backAnnotate();'>Revise My Annotate</a>
	</div>
 

<ul class="nav nav-tabs">

  <li class="nav-item">
    <a class="nav-link" style="cursor: pointer;" onclick="showAll();">All Feedback</a>
  </li>
    <li class="nav-item">
    <a class="nav-link active" style="cursor: pointer;" onclick="filterFeedback();">Smart Review</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" href="#">Action Plan</a>
  </li>
</ul>





<div class="row">    

		

<!--user input-->
<div class="modal fade" id="annotate" aria-hidden="true" role="dialog">
  	<div class="modal-dialog" role="document">
    <div class="modal-content">
    	<div class="modal-header">
    		<p id='selected-text'></p>
    	</div>
      	
      	<div class="modal-body">
      	<form>      	
	      	<div class="form-group">
	    		<label for="topic"><b>Create an Action Item</b></label>
	   	 		<input type="email" class="form-control" id="topic" aria-describedby="emailHelp" placeholder="e.g. Select an image with a sun">
	    		<small class="form-text text-muted">Use a few words to decribe what you will do with this feedback.</small>
	    		
	  		</div>


	  		<hr>
	  		<div class="form-group">
	    		<label for="topic"><b>Associate This Action Item with ...</label></b>
	   	 		<select>
	   	 			<option>Select an image without sun glare.</option>
	   	 			<option>Select an image with multiple people.</option>
	   	 		</select>
	  		</div>
      		<hr>
      		<div class="form-check form-check-inline">
						  <input class="form-check-input filter-input" type="checkbox"  value="no-value">
						  <label class="form-check-label" for="criticality"><b>Mark as no action needed for solving this item</b></label>
						</div>
      	</form>
      	</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="col-md-6 col-sm-6">


<!--Panel-->
<table class="table" width="100%">
	<thead>
    <tr>
      <th scope="col">Topic</th>
      <th scope="col">Relevant Feedback</th>
    </tr>
  </thead>

<tbody id='paneltest'>
	
</tbody>
</table>



</div>

<div class="col-md-6 col-sm-6"> 
	
<div class="card">
	     <div class="card-header">
    Show Areas of Feedback
  </div>
  <div class="card-body">
 
  		<form>

				<div class="form-group row">
				    <legend class="col-sm-6 col-form-label"><b>Estimated Revision Effort</b></legend>
				    <div class="col-sm-6">
						<input type="range" name="foo" min="0" max="5" step="1">
						<output for="foo" onforminput="value = foo.valueAsNumber;"></output>
				    </div>
				 </div>

				<div class="form-group row">
				    <legend class="col-sm-6 col-form-label"><b>Criticality</b></legend>
					<div class="col-sm-6">
						<input type="range" name="foo" min="0" max="5" step="1">
						<output for="foo" onforminput="value = foo.valueAsNumber;"></output>
				    </div>
				 </div>

				 <div class="form-group row">
				     <legend class="col-sm-6 col-form-label"><b>Agree</b></legend>
				    <div class="col-sm-6">
						<input type="range" name="foo" min="0" max="5" step="1">
						<output for="foo" onforminput="value = foo.valueAsNumber;"></output>
				    </div>
				 </div>



		</form>

  
  </div>
</div>
			


<table class='table table-nonfluid'>
	<tbody id='feedback-list'>
	</tbody>
</table>
	




</div>

</div>
</div><!--end of page 2-->



</div>








		
</div>
<script>

//Get dataset

function LoadData(){

	var team= $('#team-name').val();
	
}


//GET DATA
var sentimentColor= {'strength':'#99ff99','weakness':'#ffcccc','neutral':'#99ccff'};

var all_idea_units = {};
var number_of_providers=0;

var visual_status = {};
//var topicName=['image','layout'];
var sentimentName=['strength','neutral', 'weakness'];
var topicArray={};
var topics=[];
var selectedFigure=[];

$(function(){


$("#range").slider({

  // the id of the slider element
  id: "",

  // minimum value
  min: 0,

  // maximum value
  max: 10,

  // increment step
  step: 1,

  // the number of digits shown after the decimal.
  precision: 0,

  // 'horizontal' or 'vertical'
  orientation: 'horizontal',

  // initial value
  value: 5,

  // enable range slider
  range: false,

  // selection placement. 
  // 'before', 'after' or 'none'. 
  // in case of a range slider, the selection will be placed between the handles
  selection: 'before',

  // 'show', 'hide', or 'always'
  tooltip: 'show',

  // show two tooltips one for each handler
  tooltip_split: false,

  // 'round', 'square', 'triangle' or 'custom'
  handle: 'round',

  // whether or not the slider should be reversed
  reversed: false,

  // whether or not the slider is initially enabled
  enabled: true,

  // callback
  formatter: function formatter(val) {
    if (Array.isArray(val)) {
      return val[0] + " : " + val[1];
    } else {
      return val;
    }
  },

  // The natural order is used for the arrow keys. 
  // Arrow up select the upper slider value for vertical sliders, arrow right the righter slider value for a horizontal slider - no matter if the slider was reversed or not. 
  // By default the arrow keys are oriented by arrow up/right to the higher slider value, arrow down/left to the lower slider value.
  natural_arrow_keys: false,

  // Used to define the values of ticks. 
  // Tick marks are indicators to denote special values in the range. 
  // This option overwrites min and max options.
  ticks: [],

  // Defines the positions of the tick values in percentages. 
  // The first value should always be 0, the last value should always be 100 percent.
  ticks_positions: [],

  // Defines the labels below the tick marks. Accepts HTML input.
  ticks_labels: [],

  // Used to define the snap bounds of a tick. 
  // Snaps to the tick if value is within these bounds.
  ticks_snap_bounds: 0,

  // Used to allow for a user to hover over a given tick to see it's value.
  ticks_tooltip: false,

  // Position of tooltip, relative to slider. 
  // Accepts 'top'/'bottom' for horizontal sliders and 'left'/'right' for vertically orientated sliders. 
  // Default positions are 'top' for horizontal and 'right' for vertical slider.
  tooltip_position: null,

  // Set to 'logarithmic' to use a logarithmic scale.
  scale: 'linear',

  // Focus the appropriate slider handle after a value change.
  focus: false,

  // ARIA labels for the slider handle's, Use array for multiple values in a range slider.
  labelledby: null,

  // Defines a range array that you want to highlight
  rangeHighlights: []
  
});






//$.get('data1.html', null, function(text){

  //$('[data-toggle="tooltip"]').tooltip(); 
	$(".table-text").each(function (table_i) {
		
		var current_html_table = $($('div#page-1 template[name="feedback_table"]').html());
		var reviewer_i = table_i + 1;
		number_of_providers=reviewer_i;
		var text=($(this).text().trim()).match(/[^\.!\?]+[\.!\?]+/g);
		//var text = ($(this).text().trim()).split(/(?<=[\.!?])/);
		current_html_table.attr('id',reviewer_i);
		$('a', current_html_table).attr('href', '#original'+reviewer_i );
		$('[name="original-feedback"]', current_html_table).html("<b>Original Feedback : </b><br>"+ $(this).text()+"<br>");
		$('[name="original-feedback"]', current_html_table).attr('id','original'+reviewer_i );
		var text_vis_table='';

		

		for (var i = 0; i < text.length; i++) {
			
				var current_idea_id = reviewer_i+ '-'+i;
		
				text_vis_table=text_vis_table+	"<span class='idea-unit' data-toggle='modal' data-target='#annotate' id='" + current_idea_id + "'>" + text[i] + "</span>";

			var current_feedback_row = $($('div#page-1 template[name="feedback-row-template"]').html());
			current_feedback_row.attr('id', current_idea_id );
			$('[name="ideaid"]', current_feedback_row).html(current_idea_id);
			$('[name="content"]', current_feedback_row).html(text[i]);
			$('[name="add-btn"]', current_feedback_row).attr('id', current_idea_id);
			$('[name="topic"]', current_feedback_row).attr('id', current_idea_id);
			$('[name="new-topic"]', current_feedback_row).attr('id', "newfor"+current_idea_id);
			
			//var text_spanned="<tr id='" + reviewer_i + "-" + i + "'> <th scope='row'>"+reviewer_i+ "-" + i+"</th><td>"+text[i]+"</td><td><select name='topic'><option></option><option>image</option><option>layout</option><option>font</option><option>color</option><option>copy issue</option></td><td><select name='sentiment'><option></option><option>positive</option><option>negative</option><option>suggestion</option></select></td><td><select name='effort'><option></option><option>high</option><option>medium</option><option>low</option></select></td><td><select name='criticality'><option></option><option>high</option><option>medium</option><option>low</option></select></td><td><select name='discussion'><option></option><option>yes</option><option>no</option></td> <td><select name='agree'><option></option><option>completely</option><option>partially</option><option>no</option></td> </tr>";
			
			$('#ideaunits', current_html_table).append(current_feedback_row);

			var ideaunit = {
				id: current_idea_id,
				content: text[i],
				topic: null,
				sentiment: 0,
				criticality: 0,
				effort: 0,
				discussion: false,
				agree: 0,
				visited:false,
				action:null
			};

			all_idea_units[current_idea_id] = ideaunit;
			

			
	
		}//end for loop

		$('#all_feedback_table').append(current_html_table);

		$('#page-list').append($("<li class='page-item'><a class='page-link' id='feedback-"+reviewer_i+"'>"+reviewer_i+"</a></li>"));

		$('#feedback-list', "div#page-2").append("<tr class='feedback-cell' id='person"+reviewer_i+"'><td><strong>#"+reviewer_i+"</strong></td><td class='vis-content'>"+text_vis_table+"</td></tr>");

		$('#feedback-list', "div#all-feedback").append("<tr class='feedback-cell' id='person"+reviewer_i+"'><td><strong>#"+reviewer_i+"</strong></td><td class='vis-content'>"+text_vis_table+"</td></tr>");

		$('.feedback-row#'+reviewer_i+'-0 [name="merge"]').hide();
		
	})

		$(".page-item:eq(0)").addClass('active');
		$(".annotate-panel#1").show();

		$(".page-link").click(function(){
			$(".page-item").removeClass('active');
			$(this).closest(".page-item").addClass('active');
			var current_page= $(this).attr("id").split('-');
			$(".annotate-panel", "#page-1").hide();
			$(".annotate-panel#"+current_page[1], "#page-1").show();
		});

		$("select", "#page-1")
	  		.change(function () {

	    	var current_tag= $(this).attr("name");
	      	var current_idea= $(this).closest("tr").attr("id");
	      	//var current_value = $(this).find(":selected").text();
	      	all_idea_units[current_idea][current_tag] = $(this).find(":selected").text();
	      	//console.log(JSON.stringify(all_idea_units[current_idea]));	     	
		 });
		


	$("div#page-1").on('click', "[name=merge]", function(){

		var current_row= $(this).closest(".feedback-row");
		var previous_row=current_row.prev(".feedback-row");
		
		var current_id=current_row.attr('id');			
		var pre_idea_id = previous_row.attr('id')		
		//update all_idea_unit
		var tmp_content=$(".feedback-row#"+current_id +" [name='content']").text();
		//alert(tmp_content);
		all_idea_units[pre_idea_id]['content'] += tmp_content ;
		//alert(all_idea_units[pre_idea_id]['content']);
		$('.feedback-row#'+pre_idea_id+' [name="content"]').text(all_idea_units[pre_idea_id]['content'] );
		$('.feedback-row#'+current_id).remove();
		delete all_idea_units[current_id];
		//delete all_idea_units[current_id];
		//alert( $(".feedback-row#"+current_id +" [name='content']").text());
		//alert(all_idea_units[pre_idea_id]['content']);

		var current_span= $("span#"+current_id+".idea-unit");
		//alert(current_span.attr('id'));
		//var current_row= $("span.idea-unint#"+current_id);
    	current_span.prev().append(current_span.text());
    	current_span.remove();

		
	});


// Page 2


	$("div#page-2").on('click', ".filter-input", function(){

		renderInterpretation();

	});

	$("div#page-2").on('click','.tableelement', function() {
		
		var span_id = $(this).attr("id").split('-');
		var topic= span_id[0];
		var sentiment=span_id[1];
		var people_id=span_id[2];
		
		//todo
		for(var key in all_idea_units){
			//console.log(tmp);
			var tmp_id=key.split('-');
			if( (tmp_id[0] == people_id)&&(sentiment==all_idea_units[key]['sentiment'])&&(topic == all_idea_units[key]['topic']))
			{				
				console.log(key);
		//todo
				//$("span.idea-unit#"+key, "#page-2").addClass("visited");
				all_idea_units[key].visited=true; 
				//$(".tableelement#"+key+" > span", "#page-2").css("color","blue");

			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
		}


		if(visual_status[$(this).attr("id")] == false){
			$(this).addClass("selectElement");
			visual_status[$(this).attr("id")]=true;
			//alert(visual_status[$(this).attr("id")]);
		}else{
			$(this).removeClass("selectElement");
				visual_status[$(this).attr("id")]=false;
		}

		SelectFeedback(visual_status);

	})

	$("div#page-2").on('mouseenter','.tableelement', function() {
		

		var span_id = $(this).attr("id").split('-');
		var topic= span_id[0];
		var sentiment=span_id[1];
		var people_id=span_id[2];
		console.log(span_id);
		//todo
		for(var key in all_idea_units){
			//console.log(tmp);
			var tmp_id=key.split('-');
			if( (tmp_id[0] == people_id)&&(sentiment==all_idea_units[key]['sentiment'])&&(topic == all_idea_units[key]['topic']))
			{				
				$("span.idea-unit#"+key, "#page-2").addClass("active-text");
				//all_idea_units[key].visited=true; 
				//$(".tableelement#"+key+" > span", "#page-2").css("color","blue");
			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
		}

	});

	$("div#page-2").on('mouseleave','.tableelement', function() {
		
	    $("span.idea-unit", "#page-2").removeClass("active-text");
	    
	  
	});


	//$("div#page-1").on('click','.add-btn', addOption);

	$("div#page-1").on('focusout','[name="new-topic"]', addOption);	

	$("span.idea-unit", "page-2").hover(

		 	function() {
		 		
  				var span_id = $(this).attr("id");
  				var people_id=span_id.split('-');
  				console.log(span_id);
				for(var i=0; i<topicArray.length;i++)// lopping the topic
				{				
					for(var sentiment=0; sentiment < topicArray[i].length;sentiment++)
					{
						var currentArray=topicArray[i][sentiment];
						for(var idx_unit=0; idx_unit<currentArray.length;idx_unit++)// lopping the topic
						{
							
							if(span_id == currentArray[idx_unit].id){
								console.log("get it");
								$(".tableelement#"+topicName[i]+'-'+sentiment+'-'+people_id[0]+" > span").addClass("active-icon");	
				
							}
							
						}		
					}

				}
						
			},
			function() {
				$(".tableelement > span").removeClass("active-icon");
			}
	);


	//prototype
	all_idea_units=labeled;
	

});

function getIdeaUnits(topic_key, sentiment_key, people_id) {
	console.log(topic_key, sentiment_key, people_id);
	var idea_units = [];
	for (idea_unit_key in all_idea_units) {
		var idea_unit = all_idea_units[idea_unit_key];
		var idea_people_id = parseInt(idea_unit_key.split('-')[0]);
		if (idea_people_id === people_id && idea_unit['topic'] === topic_key && idea_unit['sentiment'] === sentiment_key) {
			idea_units.push(idea_unit['content']);
		}
	}
	return idea_units.join('<br>');
}

//var topics=[];


function SelectFeedback(){

	$(".feedback-cell").hide();

	
	for (var key in visual_status) {
			var person= key.split('-')[2];
			var sentiment= key.split('-')[1];
			var topic= key.split('-')[0];

		if(visual_status[key]==true){

			$(".feedback-cell#person"+person).show();

			for(var idea in all_idea_units){
			//console.log(tmp);
			var tmp_id=idea.split('-');
			if( (tmp_id[0] == person)&&(sentiment==all_idea_units[idea]['sentiment'])&&(topic == all_idea_units[idea]['topic']))
			{				
				$("span.idea-unit#"+idea, "#page-2").css("background",sentimentColor[sentiment]);
		
			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
			}

		}else
		{
			for(var idea in all_idea_units){
			//console.log(tmp);
			var tmp_id=idea.split('-');
			if( (tmp_id[0] == person)&&(sentiment==all_idea_units[idea]['sentiment'])&&(topic == all_idea_units[idea]['topic']))
			{				
				$("span.idea-unit#"+idea, "#page-2").css("background","");
		
			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
			}
		}
		
	}

}




function showAll(){
	$("div#page-2").hide();
	$(".feedback-cell","div#all-feedback").show();
	
	$("div#all-feedback").show();

}


function filterFeedback(){
	SelectFeedback();
	$("div#page-2").show();
	$("div#all-feedback").hide();

}

function addOption(){
   
	$("p[name='check-result']").text("").removeClass();
    var element=$(this);
    element.siblings("#check-result").text("").removeClass();
    var id=element.attr('id');
    //console.log("call addoption",id);
   	var tmptopic = $(this).val();

   	//console.log("new topic", tmptopic, topics.indexOf(tmptopic) );
	/*$.map( $(".feedback-row select[name='topic']:first option"), function (option){
		topics.push(option.value);
	} 
	);*/
   //var options= $(el).parent().children("select option");

  var msg='';
  var status='success';

   if( tmptopic!="")
   {

   		 if( topics.indexOf(tmptopic) == -1){

   		 	var currentid=element.parent().children("select").attr("id");
   			console.log("in if", currentid);

   				topics.push(tmptopic);
   				$(".feedback-row select[name='topic']").each(function(){
    	
					$(this).append( new Option( tmptopic, $('#new-topic').val(), false, false) );
    			//$(this).options[$(this).options.length] = new Option('New Element', '0', false, false);
    			});
   				//console.log(element.parent().children("select").attr("id"));
				element.parent().children("select").val(tmptopic);
				//element.parent().children("select").css('background-color','yellow');
				//$(el).parent().children("select option[value='"+tmptopic+"']").attr('selected','selected');
				all_idea_units[currentid]['topic'] =tmptopic;
	   		 	console.log(JSON.stringify(all_idea_units[currentid]));
	    		//element.siblings("#check-result").text("Successfully added"+).addClass('success');
	    		msg="'"+tmptopic+"' is added!";
	    		status='success';
   				
   		 }else
   		 {
   		 		msg="'"+tmptopic+"' alrady exists!";
   				status='fail';
   		 } 

   		 element.siblings("[name='check-result']").text(msg).addClass(status);
		element.val("");
   		
   }
  
    
}




function finishAnnoate(){

	createTopicArray();
	renderElement();
	renderFactual();

	$('#all-feedback').show();
	$('#page-1').hide();
}


function backAnnotate(){

	$('#page-1').show();
	$('#page-2').hide();
}
//For page 2
    
function createTopicArray()
{
	//all_idea_units=labeled;

	topicArray={};
	//var number_of_idea= Object.keys(all_idea_units).length;
	for (var key in all_idea_units) {
    // check if the property/key is defined in the object itself, not in parent
    //console.log(all_idea_units[key]['topic']);
    var current_topic=all_idea_units[key]['topic'];
    var current_sentiment=all_idea_units[key]['sentiment'];
    //console.log(current_topic,current_sentiment );	
    	if(current_topic!=null && current_sentiment!=0){
	    	if(!(current_topic in topicArray))
	    	{
	    		var currentArray={};
	    		sentimentName.forEach(function(element) {
  					currentArray[element] =new Array();
				});

	    		topicArray[current_topic] = currentArray;
	    	}
	    	topicArray[current_topic][current_sentiment].push(all_idea_units[key]);
	    	//console.log(JSON.stringify(topicArray));
		}


		

    }
}



function print(par)
{
	console.log(par);
}	




function renderElement(){
	
	$("#paneltest").empty();



	for (var topicKey in topicArray) {
		
		var currentTopic=topicArray[topicKey];
		var inser_html="";

		
		inser_html=inser_html+"<tr id='"+topicKey+"'><th scope='row' style='text-align:center;'>"+topicKey+"</th><td>";
		//Render human icons
		inser_html+="<table border='0' class='topic-people'><tr><td></td>";
		var people_id=1;
		for(var index=0; index<number_of_providers;index++)// lopping the topic
		{
			inser_html=inser_html+"<td><span class='fa fa-user human-figure'></span></td>";
				people_id++;
		}
		inser_html+="</tr>";
	
		for (var sentimentKey in currentTopic) {
			
			inser_html+="<tr id='sentiment"+sentimentKey+"'><td width='15%'><b>"+sentimentKey+'</b></td>';
			people_id=1;
			for(var index=0; index<number_of_providers;index++)// lopping the topic
			{
				var currentID=topicKey+'-'+sentimentKey+'-'+people_id;
				var associated_idea_units = getIdeaUnits(topicKey, sentimentKey, people_id).replace('"', '\''); // convert " to '
				if (people_id===3) console.log(associated_idea_units);
				inser_html=inser_html+"<td><div data-toggle='tooltip' title=\""+associated_idea_units+"\" class='tableelement' id='"+currentID+"'></div></td>";
				people_id++;

				visual_status[currentID]=false;
			}
			inser_html+="</tr>";
			
		}
		inser_html+="</table></td></tr>";
		
		$("#paneltest").append(inser_html);
	}

	// enable tooltips
	$('#paneltest div[data-toggle]').tooltip({'html': true});
}

function renderFactual(){

	for (var key in all_idea_units) {
		var people_id=key.split('-');
		//console.log("#"+all_idea_units[key]['topic']+'-'+all_idea_units[key]['sentiment']+'-'+people_id[0]);
		var tmp_sentiment=all_idea_units[key]['sentiment'];
		$("#"+all_idea_units[key]['topic']+'-'+all_idea_units[key]['sentiment']+'-'+people_id[0]).css('background',sentimentColor[tmp_sentiment]);	
	}

}
	




function renderInterpretation(){

	var selectedID=[];
	var numToString=['low','low','low','medium','high','high'];
	
	var checked_effort = [];
	var checked_criticality = [];
	var need_discussion = [];
	var agreement = [];


	$('input[name=effort]:checked').each(function() {checked_effort.push($(this).attr('value'));});
	$('input[name=criticality]:checked').each(function() {checked_criticality.push($(this).attr('value'));});
	$('input[name=discussion]:checked').each(function() {need_discussion.push($(this).attr('value'));});
	$('input[name=agree]:checked').each(function() {agreement.push($(this).attr('value'));});
//if nothing is selected 
if( checked_effort.length > 0 || checked_criticality.length>0 || need_discussion.length>0 || agreement.length>0 )
{


	for (var key in all_idea_units) {
		var people_id=key.split('-')[0];

		var current_topic = all_idea_units[key]['topic'];
		var current_sentiment = all_idea_units[key]['sentiment'];

		var current_effort = all_idea_units[key]['effort'];
		var current_criticality = all_idea_units[key]['criticality'];

		var current_discussion = all_idea_units[key]['discussion'];
		var current_agreement = all_idea_units[key]['agree'];


		if( (checked_effort.length>0 == checked_effort.indexOf(current_effort)>-1) 
			&& (checked_criticality.length>0 == checked_criticality.indexOf(current_criticality)>-1 )
			&& (need_discussion.length>0 == need_discussion.indexOf(current_discussion)>-1 )
			&& (agreement.length>0 == agreement.indexOf(current_agreement)>-1))
		{
			selectedID.push(key);
			$(".tableelement#"+current_topic+'-'+current_sentiment+'-'+people_id+" > span").addClass('highlight');	
		}
		else
		{
			$(".tableelement#"+current_topic+'-'+current_sentiment+'-'+people_id+" > span").removeClass('highlight');	
		}		
	}
	
}else{
	$('.tableelement span').removeClass('highlight');
}

	SelectFeedback(selectedID);

}


</script>