<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="Grace Yen, Adobe System Corp.">
  
    <title>Prototype</title>
  
    <!-- For tooltip -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<script type="text/javascript" src="bootstrap-4.1.3-dist/js/bootstrap.bundle.min.js"></script>
	
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<!-- the link below is too slow -->
	<!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<!-- JQuery and Google font -->
    <link href='https://fonts.googleapis.com/css?family=Exo:100,400' rel='stylesheet' type='text/css'>
	<!-- Custom styles for this template -->
	<link href="css/bootstrap-slider.css" rel="stylesheet">

	<script src="dist/js/bootstrap-slider.js"></script>
	<script src="labeled.js"></script>

<style>
        .droptarget {
            float: left; 
	        width: 300px; 
	        height: 3500px;
	        margin: 15px;
	        padding: 10px;
	        border: 1px solid #aaaaaa;
   		}
    	mark{
    		background: orange;
    		color: black;
		}
		.idea-unit:hover {
			cursor: pointer;
			background-color: lightgray;
		}

		.visited { 
		    background-color: lightgrey;
		}

	
		.highlight{
			color: blue !important;;
		}

		.active-icon{
			color: red !important;
		}

.active-text{
	/*background-color: yellow !important;*/
	border: 4px solid grey;
}
.vis-content{
	text-align: justify; 
	padding-bottom:10px; 
	padding-right:25px;
}

p.success{
	color:green;
}
p.fail{
	color:red;
}

.original-feedback{
	margin: 10px;
	font-size: 20px;
}



.topic-row{
	text-align: center;
}

.topic-field{
	display: inline-block;
	font-weight: bold;
}

.tableelement {
	width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #dfe2de;
    cursor: pointer;
    margin: 3px;
}
table.topic-people{
	border: 0px;
}
table.topic-people td{
	padding-top: 2px;
	padding-right: 2px;
	padding-bottom: 2px;
	padding-left: 0px;
	border: 0;

}

.tableelement.selectElement{
	 box-shadow: 0 0 2pt 2pt grey; 
}

.human-figure{
	color:grey; font-size:32px; margin:6px
}

.tooltip-inner {
	background-color: white;
	color: black;
	max-width: 550px;
	font-size: 2rem;
	border: 1px black solid;
}

</style>

</head>

<body>
<!--Consider set as element for django-->
<nav class="navbar navbar-fixed-top navbar-inverse" style="background:#002058">
        <div class="container">
            <div class="navbar-header">
               FeedbackPanel
            </div>  
        </div>
</nav>

<div style='display: none'>
	<span class='table-text'>
		The image is nice and sharp. It has all of the necessary information required. The text looks a bit unprofessional, I would have preferred something a bit more serious looking. The runner looks as if they are floating. I get the idea, but it looks a bit fake. The lens flare is a cool looking effect to silhouette the runner. The pink on the runner's shoes really helps to draw the eye to what the runner is doing. I really like this bit of detail.</span>
	<span class='table-text'>
		The Picture shown a woman running in a highway type of road, which doesn't fit the location (Central Park) of this race. Also, the girl seems to be shrunk a little bit, the shape looks not right. I found the fonts used in this poster kind of not very professional. I would adjust the size of the main title (Run@NYC) to make it bigger and put it in the middle top rather than the left. The "register...." line is way too small and again I would use a different font for it. I would use sharper colors other than black and white too. Overall, it's not a very good design.</span>
	<span class="table-text">I would rate the overall concept of the design to be quite good. I like the picture with the sun behind the runner which acts somewhat motivational to me. One downside i see is the very small letter size for the registration link site and don't like how curved is the "price win announcement" - maybe better to be again on the bottom right but normal like the other sentences. Other than that, I think it looks quite good and appealing.
	</span>
	<span class='table-text'>The design is good but would have be much better if there was more bright color used and the fonts used should be more bold and good looking. The information should be more given with better details. The graphics used should be more appealing. The girl looking dull because of sun shade, it might be avoided. There is lot of space which could be better utilized. For the half marathon, the group of people running is better to be shown than just a single girl running. The color should be lively and appealing to make the flyer looking good.</span>

	<span class='table-text'>I really like the attention put to the 300$ prizes. It will get more people to read the flyer, very good design choice. However, I dislike the stock photo that is put on top off, the girl looks like shes hovering, it’s very distracting. Also, the sun glare is very distracting as well, it’s not a really good photo. The flyer looks somehow low effort, its just text on a stock image (not a very good one at that). But it does convey everything it needs to. But I think it’s a huge waste printing a stock photo with 4 lines of text on it.
</span>

	<span class='table-text'>I enjoy the image itself and the font variation and overall color scheme because it seems to be in motion and highlights very well what the topic is as well. I really like the font because they aren't your standard Sans Serif type fonts that you see pretty routinely. It helps it stand out a bit and I enjoy for that fact. They have a nice contrast as well that makes them easy to read even if they are a bit on the cursive side.
 </span>


<span class='table-text'>The flyer has important information about the half marathon but it lacks a visual appeal. I think a better color composition could be used to make it more eye catching. I also believe that important Information like the cause being supported through the marathon could be included to attract more participants. The various elements of the flyer like text, images etc. seem to lack sync and a better alignment of the various elements can make the flyer stand out by giving it a balanced look.
</span>
<span class='table-text'>The background image should have been edited a bit. I don't see detailing in the image. One cannot get the whole information about the event looking at the poster. The font at the top "RUN@NYC" looks good. But there are very less details about the event. The font "Top 3 runners" should not be tilted. The font size for all three details is different and the is not looking good. Needs a lot of change. But it would end up being a good flyer.
</span>

<span class='table-text'>The visual element of the design is captivating with regards to the background. The font used is also nice but seems like it was very quickly done and not much thought or effort put into it. Again, the background image is nice, but the words seem too plain and not as "fun" or "inviting". Perhaps some encouraging words can be used to 'invite' runners for the event. The sun and shadow is a very nice and captivating image, but at times seems the suns brightness is a bit bothersome. Overall it is a nice flyer and some minor changes can be added/made.
</span>

</div>

<div id='page-1'>  
	<div class="container">
			<div class="main-section" style="margin-top: 50px">
		<div class="alert alert-info" role="alert" >
			<h4>Instruction</h4>
			 Please select values that make most sense to you blablabla. 
			<a type="button" class="btn btn-info" onclick='finishAnnoate();'>View My MindSpace</a>
		</div>
  		<nav aria-label="Page navigation example">
		  <ul class="pagination" id="page-list">
		  </ul>
		</nav>

		<div class="row" id='all_feedback_table'></div>

<template name='feedback_table'>
	<div class="annotate-panel" style='display:none;'>
	  <a class="btn btn-primary" data-toggle="collapse" href="" role="button" aria-expanded="false" >Read Origianl Feedback</a>

	<div class='collapse multi-collapse' name='original-feedback'></div>


	<table class='table table-hover table-nonfluid'>
		<thead>
		    <tr>
		      <th style="width:5%" scope="col">#</th>
		      <th style="width:30%" scope="col">Content</th>
		      <th style="width:5%" scope="col"></th>
		      <th style="width:10%" scope="col">Topic</th>
		      <th style="width:10%" scope="col">Sentiment</th>
		      <th style="width:10%" scope="col">Estimtated Effort</th>
		      <th style="width:10%" scope="col">Criticality</th>
		      <th style="width:10%" scope="col">Need Discussion</th>
		      <th style="width:10%" scope="col">Agree</th>
		    </tr>
		  </thead>
	
	<tbody id='ideaunits'>
		
	</tbody>
	</table>
	</div>

</template>

<template name='feedback-row-template'>
	<tr class='feedback-row'> 
		<th name='ideaid' scope='row'></th>
		<td name='content'></td>
		<td><button type="button" name='merge' class="btn btn-info">Merge</button></td>
		<td>
			<div class='topic-section1'>
				<span>Give a label</span>
				<input type='text' style='display: inline-block;' name='new-topic'>
				<!--<button class='add-btn' name='add-btn'><span class='fa fa-plus' style=" font-size:24px;margin-right:3px"></span></button>-->
				<p name='check-result'></p>
				<br><br>

				Select from existing labels
			<select name='topic' style="margin-bottom: 5px">
				<option>Select from... </option>
			</select>				
				
			
			
		</div>
		</td>

		<td><select name='sentiment'>
				<option></option>
				<option>strength</option>
				<option>weakness</option>
				<option>neutral</option>
			</select>
		</td>
		<td><select name='effort'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='criticality'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='discussion'>
				<option></option>
				<option>yes</option>
				<option>no</option>
		</td> 
		<td><select name='agree'>
			<option></option>
			<option>completely</option>
			<option>partially</option>
			<option>no</option>
		</td> 
	</tr>
	
</template>


<template name='feedback-row-template'>
	<tr class='feedback-row'> 
		<th name='ideaid' scope='row'></th>
		<td name='content'></td>
		<td><button type="button" name='merge' class="btn btn-info">Merge</button></td>
		<td>
			<div class='topic-section1'>
				<span>Give a label</span>
				<input type='text' style='display: inline-block;' name='new-topic'>
				<!--<button class='add-btn' name='add-btn'><span class='fa fa-plus' style=" font-size:24px;margin-right:3px"></span></button>-->
				<p name='check-result'></p>
				<br><br>

				Select from existing labels
			<select name='topic' style="margin-bottom: 5px">
				<option>Select from... </option>
			</select>				
				
			
			
		</div>
		</td>
		<td><select name='sentiment'>
				<option></option>
				<option>strength</option>
				<option>weakness</option>
				<option>neutral</option>
			</select>
		</td>
		<td><select name='effort'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='criticality'>
				<option></option>
				<option>high</option>
				<option>medium</option>
				<option>low</option>
				<option>N/A</option>
			</select>
		</td>
		<td><select name='discussion'>
				<option></option>
				<option>yes</option>
				<option>no</option>
		</td> 
		<td><select name='agree'>
			<option></option>
			<option>completely</option>
			<option>partially</option>
			<option>no</option>
		</td> 
	</tr>
	
</template>


</div>
</div>

</div>
<!------Show All Feedback--------------------------------------------------->
<div id='all-feedback' style="display: none;">	
<div class="container-fluid">
	<div class="main-section" style="margin-top: 50px">

<div class="alert alert-info" role="alert" >
		<h4>Instruction</h4>
	 We collect six pieces of feedback from independent reviewers. The feedback set is categorized and transformed into a summary panel (on the right hand side). You can interact with the panel to explore the feedback set. 

	 <a type="button" class="btn btn-info" onclick='backAnnotate();'>Revise My Annotate</a>
	</div>
 

<ul class="nav nav-tabs">
  <li class="nav-item">
    <a class="nav-link active" style="cursor: pointer;" onclick="showAll();">All Feedback</a>
  </li>
    <li class="nav-item">
    <a class="nav-link " style="cursor: pointer;" onclick="filterFeedback();">Smart Review</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" href="#">Action Plan</a>
  </li>
</ul>


		<table class='table table-nonfluid'>
	<table class='table table-nonfluid'>
	<tbody id='feedback-list'>
	</tbody>
</table>
	</table>
	
	</div>
</div>

</div>
<!------End Show All Feedback--------------------------------------------------->

<div id='page-2' style="display: none;">


<div class="container-fluid">
	<div class="main-section" style="margin-top: 50px">


	<div class="alert alert-info" role="alert" >
		<h4>Instruction</h4>
	 We collect six pieces of feedback from independent reviewers. The feedback set is categorized and transformed into a summary panel (on the right hand side). You can interact with the panel to explore the feedback set. 

	 <a type="button" class="btn btn-info" onclick='backAnnotate();'>Revise My Annotate</a>
	</div>
 

<ul class="nav nav-tabs">

  <li class="nav-item">
    <a class="nav-link" style="cursor: pointer;" onclick="showAll();">All Feedback</a>
  </li>
    <li class="nav-item">
    <a class="nav-link active" style="cursor: pointer;" onclick="filterFeedback();">Smart Review</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" href="#">Action Plan</a>
  </li>
</ul>





<div class="row">    

		

<!--user input-->
<div class="modal fade" id="annotate" aria-hidden="true" role="dialog">
  	<div class="modal-dialog" role="document">
    <div class="modal-content">
    	<div class="modal-header">
    		<p id='selected-text'></p>
    	</div>
      	
      	<div class="modal-body">
      	<form>      	
	      	<div class="form-group">
	    		<label for="topic"><b>Create an Action Item</b></label>
	   	 		<input type="email" class="form-control" id="topic" aria-describedby="emailHelp" placeholder="e.g. Select an image with a sun">
	    		<small class="form-text text-muted">Use a few words to decribe what you will do with this feedback.</small>
	    		
	  		</div>


	  		<hr>
	  		<div class="form-group">
	    		<label for="topic"><b>Associate This Action Item with ...</label></b>
	   	 		<select>
	   	 			<option>Select an image without sun glare.</option>
	   	 			<option>Select an image with multiple people.</option>
	   	 		</select>
	  		</div>
      		<hr>
      		<div class="form-check form-check-inline">
						  <input class="form-check-input filter-input" type="checkbox"  value="no-value">
						  <label class="form-check-label" for="criticality"><b>Mark as no action needed for solving this item</b></label>
						</div>
      	</form>
      	</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="col-md-6 col-sm-6">


<!--Panel-->
<table class="table" width="100%">
	<thead>
    <tr>
      <th scope="col">Topic</th>
      <th scope="col">Relevant Feedback</th>
    </tr>
  </thead>

<tbody id='paneltest'>
	
</tbody>
</table>



</div>

<div class="col-md-6 col-sm-6"> 
	
<div class="card">
	     <div class="card-header">
    Show Areas of Feedback
  </div>
  <div class="card-body">
 
  		<form>

				<div class="form-group row">
				    <legend class="col-sm-6 col-form-label"><b>Estimated Revision Effort</b></legend>
				    <div class="col-sm-6">
						<input type="range" name="foo" min="0" max="5" step="1">
						<output for="foo" onforminput="value = foo.valueAsNumber;"></output>
				    </div>
				 </div>

				<div class="form-group row">
				    <legend class="col-sm-6 col-form-label"><b>Criticality</b></legend>
					<div class="col-sm-6">
						<input type="range" name="foo" min="0" max="5" step="1">
						<output for="foo" onforminput="value = foo.valueAsNumber;"></output>
				    </div>
				 </div>

				 <div class="form-group row">
				     <legend class="col-sm-6 col-form-label"><b>Agree</b></legend>
				    <div class="col-sm-6">
						<input type="range" name="foo" min="0" max="5" step="1">
						<output for="foo" onforminput="value = foo.valueAsNumber;"></output>
				    </div>
				 </div>



		</form>

  
  </div>
</div>
			


<table class='table table-nonfluid'>
	<tbody id='feedback-list'>
	</tbody>
</table>
	




</div>

</div>
</div><!--end of page 2-->



</div>








		
</div>
<script>

//Get dataset

function LoadData(){

	var team= $('#team-name').val();
	
}


//GET DATA
var sentimentColor= {'strength':'#99ff99','weakness':'#ffcccc','neutral':'#99ccff'};

var all_idea_units = {};
var number_of_providers=0;

var visual_status = {};
//var topicName=['image','layout'];
var sentimentName=['strength','neutral', 'weakness'];
var topicArray={};
var topics=[];
var selectedFigure=[];

$(function(){


$("#range").slider({

  // the id of the slider element
  id: "",

  // minimum value
  min: 0,

  // maximum value
  max: 10,

  // increment step
  step: 1,

  // the number of digits shown after the decimal.
  precision: 0,

  // 'horizontal' or 'vertical'
  orientation: 'horizontal',

  // initial value
  value: 5,

  // enable range slider
  range: false,

  // selection placement. 
  // 'before', 'after' or 'none'. 
  // in case of a range slider, the selection will be placed between the handles
  selection: 'before',

  // 'show', 'hide', or 'always'
  tooltip: 'show',

  // show two tooltips one for each handler
  tooltip_split: false,

  // 'round', 'square', 'triangle' or 'custom'
  handle: 'round',

  // whether or not the slider should be reversed
  reversed: false,

  // whether or not the slider is initially enabled
  enabled: true,

  // callback
  formatter: function formatter(val) {
    if (Array.isArray(val)) {
      return val[0] + " : " + val[1];
    } else {
      return val;
    }
  },

  // The natural order is used for the arrow keys. 
  // Arrow up select the upper slider value for vertical sliders, arrow right the righter slider value for a horizontal slider - no matter if the slider was reversed or not. 
  // By default the arrow keys are oriented by arrow up/right to the higher slider value, arrow down/left to the lower slider value.
  natural_arrow_keys: false,

  // Used to define the values of ticks. 
  // Tick marks are indicators to denote special values in the range. 
  // This option overwrites min and max options.
  ticks: [],

  // Defines the positions of the tick values in percentages. 
  // The first value should always be 0, the last value should always be 100 percent.
  ticks_positions: [],

  // Defines the labels below the tick marks. Accepts HTML input.
  ticks_labels: [],

  // Used to define the snap bounds of a tick. 
  // Snaps to the tick if value is within these bounds.
  ticks_snap_bounds: 0,

  // Used to allow for a user to hover over a given tick to see it's value.
  ticks_tooltip: false,

  // Position of tooltip, relative to slider. 
  // Accepts 'top'/'bottom' for horizontal sliders and 'left'/'right' for vertically orientated sliders. 
  // Default positions are 'top' for horizontal and 'right' for vertical slider.
  tooltip_position: null,

  // Set to 'logarithmic' to use a logarithmic scale.
  scale: 'linear',

  // Focus the appropriate slider handle after a value change.
  focus: false,

  // ARIA labels for the slider handle's, Use array for multiple values in a range slider.
  labelledby: null,

  // Defines a range array that you want to highlight
  rangeHighlights: []
  
});






//$.get('data1.html', null, function(text){

  //$('[data-toggle="tooltip"]').tooltip(); 
	$(".table-text").each(function (table_i) {
		
		var current_html_table = $($('div#page-1 template[name="feedback_table"]').html());
		var reviewer_i = table_i + 1;
		number_of_providers=reviewer_i;
		var text=($(this).text().trim()).match(/[^\.!\?]+[\.!\?]+/g);
		//var text = ($(this).text().trim()).split(/(?<=[\.!?])/);
		current_html_table.attr('id',reviewer_i);
		$('a', current_html_table).attr('href', '#original'+reviewer_i );
		$('[name="original-feedback"]', current_html_table).html("<b>Original Feedback : </b><br>"+ $(this).text()+"<br>");
		$('[name="original-feedback"]', current_html_table).attr('id','original'+reviewer_i );
		var text_vis_table='';

		

		for (var i = 0; i < text.length; i++) {
			
				var current_idea_id = reviewer_i+ '-'+i;
		
				text_vis_table=text_vis_table+	"<span class='idea-unit' data-toggle='modal' data-target='#annotate' id='" + current_idea_id + "'>" + text[i] + "</span>";

			var current_feedback_row = $($('div#page-1 template[name="feedback-row-template"]').html());
			current_feedback_row.attr('id', current_idea_id );
			$('[name="ideaid"]', current_feedback_row).html(current_idea_id);
			$('[name="content"]', current_feedback_row).html(text[i]);
			$('[name="add-btn"]', current_feedback_row).attr('id', current_idea_id);
			$('[name="topic"]', current_feedback_row).attr('id', current_idea_id);
			$('[name="new-topic"]', current_feedback_row).attr('id', "newfor"+current_idea_id);
			
			//var text_spanned="<tr id='" + reviewer_i + "-" + i + "'> <th scope='row'>"+reviewer_i+ "-" + i+"</th><td>"+text[i]+"</td><td><select name='topic'><option></option><option>image</option><option>layout</option><option>font</option><option>color</option><option>copy issue</option></td><td><select name='sentiment'><option></option><option>positive</option><option>negative</option><option>suggestion</option></select></td><td><select name='effort'><option></option><option>high</option><option>medium</option><option>low</option></select></td><td><select name='criticality'><option></option><option>high</option><option>medium</option><option>low</option></select></td><td><select name='discussion'><option></option><option>yes</option><option>no</option></td> <td><select name='agree'><option></option><option>completely</option><option>partially</option><option>no</option></td> </tr>";
			
			$('#ideaunits', current_html_table).append(current_feedback_row);

			var ideaunit = {
				id: current_idea_id,
				content: text[i],
				topic: null,
				sentiment: 0,
				criticality: 0,
				effort: 0,
				discussion: false,
				agree: 0,
				visited:false,
				action:null
			};

			all_idea_units[current_idea_id] = ideaunit;
			

			
	
		}//end for loop

		$('#all_feedback_table').append(current_html_table);

		$('#page-list').append($("<li class='page-item'><a class='page-link' id='feedback-"+reviewer_i+"'>"+reviewer_i+"</a></li>"));

		$('#feedback-list', "div#page-2").append("<tr class='feedback-cell' id='person"+reviewer_i+"'><td><strong>#"+reviewer_i+"</strong></td><td class='vis-content'>"+text_vis_table+"</td></tr>");

		$('#feedback-list', "div#all-feedback").append("<tr class='feedback-cell' id='person"+reviewer_i+"'><td><strong>#"+reviewer_i+"</strong></td><td class='vis-content'>"+text_vis_table+"</td></tr>");

		$('.feedback-row#'+reviewer_i+'-0 [name="merge"]').hide();
		
	})

		$(".page-item:eq(0)").addClass('active');
		$(".annotate-panel#1").show();

		$(".page-link").click(function(){
			$(".page-item").removeClass('active');
			$(this).closest(".page-item").addClass('active');
			var current_page= $(this).attr("id").split('-');
			$(".annotate-panel", "#page-1").hide();
			$(".annotate-panel#"+current_page[1], "#page-1").show();
		});

		$("select", "#page-1")
	  		.change(function () {

	    	var current_tag= $(this).attr("name");
	      	var current_idea= $(this).closest("tr").attr("id");
	      	//var current_value = $(this).find(":selected").text();
	      	all_idea_units[current_idea][current_tag] = $(this).find(":selected").text();
	      	//console.log(JSON.stringify(all_idea_units[current_idea]));	     	
		 });
		


	$("div#page-1").on('click', "[name=merge]", function(){

		var current_row= $(this).closest(".feedback-row");
		var previous_row=current_row.prev(".feedback-row");
		
		var current_id=current_row.attr('id');			
		var pre_idea_id = previous_row.attr('id')		
		//update all_idea_unit
		var tmp_content=$(".feedback-row#"+current_id +" [name='content']").text();
		//alert(tmp_content);
		all_idea_units[pre_idea_id]['content'] += tmp_content ;
		//alert(all_idea_units[pre_idea_id]['content']);
		$('.feedback-row#'+pre_idea_id+' [name="content"]').text(all_idea_units[pre_idea_id]['content'] );
		$('.feedback-row#'+current_id).remove();
		delete all_idea_units[current_id];
		//delete all_idea_units[current_id];
		//alert( $(".feedback-row#"+current_id +" [name='content']").text());
		//alert(all_idea_units[pre_idea_id]['content']);

		var current_span= $("span#"+current_id+".idea-unit");
		//alert(current_span.attr('id'));
		//var current_row= $("span.idea-unint#"+current_id);
    	current_span.prev().append(current_span.text());
    	current_span.remove();

		
	});


// Page 2


	$("div#page-2").on('click', ".filter-input", function(){

		renderInterpretation();

	});

	$("div#page-2").on('click','.tableelement', function() {
		
		var span_id = $(this).attr("id").split('-');
		var topic= span_id[0];
		var sentiment=span_id[1];
		var people_id=span_id[2];
		
		//todo
		for(var key in all_idea_units){
			//console.log(tmp);
			var tmp_id=key.split('-');
			if( (tmp_id[0] == people_id)&&(sentiment==all_idea_units[key]['sentiment'])&&(topic == all_idea_units[key]['topic']))
			{				
				console.log(key);
		//todo
				//$("span.idea-unit#"+key, "#page-2").addClass("visited");
				all_idea_units[key].visited=true; 
				//$(".tableelement#"+key+" > span", "#page-2").css("color","blue");

			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
		}


		if(visual_status[$(this).attr("id")] == false){
			$(this).addClass("selectElement");
			visual_status[$(this).attr("id")]=true;
			//alert(visual_status[$(this).attr("id")]);
		}else{
			$(this).removeClass("selectElement");
				visual_status[$(this).attr("id")]=false;
		}

		SelectFeedback(visual_status);

	})

	$("div#page-2").on('mouseenter','.tableelement', function() {
		

		var span_id = $(this).attr("id").split('-');
		var topic= span_id[0];
		var sentiment=span_id[1];
		var people_id=span_id[2];
		console.log(span_id);
		//todo
		for(var key in all_idea_units){
			//console.log(tmp);
			var tmp_id=key.split('-');
			if( (tmp_id[0] == people_id)&&(sentiment==all_idea_units[key]['sentiment'])&&(topic == all_idea_units[key]['topic']))
			{				
				$("span.idea-unit#"+key, "#page-2").addClass("active-text");
				//all_idea_units[key].visited=true; 
				//$(".tableelement#"+key+" > span", "#page-2").css("color","blue");
			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
		}

	});

	$("div#page-2").on('mouseleave','.tableelement', function() {
		
	    $("span.idea-unit", "#page-2").removeClass("active-text");
	    
	  
	});


	//$("div#page-1").on('click','.add-btn', addOption);

	$("div#page-1").on('focusout','[name="new-topic"]', addOption);	

	$("span.idea-unit", "page-2").hover(

		 	function() {
		 		
  				var span_id = $(this).attr("id");
  				var people_id=span_id.split('-');
  				console.log(span_id);
				for(var i=0; i<topicArray.length;i++)// lopping the topic
				{				
					for(var sentiment=0; sentiment < topicArray[i].length;sentiment++)
					{
						var currentArray=topicArray[i][sentiment];
						for(var idx_unit=0; idx_unit<currentArray.length;idx_unit++)// lopping the topic
						{
							
							if(span_id == currentArray[idx_unit].id){
								console.log("get it");
								$(".tableelement#"+topicName[i]+'-'+sentiment+'-'+people_id[0]+" > span").addClass("active-icon");	
				
							}
							
						}		
					}

				}
						
			},
			function() {
				$(".tableelement > span").removeClass("active-icon");
			}
	);


	//prototype
	//all_idea_units=labeled;
	

});

function getIdeaUnits(topic_key, sentiment_key, people_id) {
	console.log(topic_key, sentiment_key, people_id);
	var idea_units = [];
	for (idea_unit_key in all_idea_units) {
		var idea_unit = all_idea_units[idea_unit_key];
		var idea_people_id = parseInt(idea_unit_key.split('-')[0]);
		if (idea_people_id === people_id && idea_unit['topic'] === topic_key && idea_unit['sentiment'] === sentiment_key) {
			idea_units.push(idea_unit['content']);
		}
	}
	return idea_units.join('<br>');
}

//var topics=[];


function SelectFeedback(){

	$(".feedback-cell").hide();

	
	for (var key in visual_status) {
			var person= key.split('-')[2];
			var sentiment= key.split('-')[1];
			var topic= key.split('-')[0];

		if(visual_status[key]==true){

			$(".feedback-cell#person"+person).show();

			for(var idea in all_idea_units){
			//console.log(tmp);
			var tmp_id=idea.split('-');
			if( (tmp_id[0] == person)&&(sentiment==all_idea_units[idea]['sentiment'])&&(topic == all_idea_units[idea]['topic']))
			{				
				$("span.idea-unit#"+idea, "#page-2").css("background",sentimentColor[sentiment]);
		
			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
			}

		}else
		{
			for(var idea in all_idea_units){
			//console.log(tmp);
			var tmp_id=idea.split('-');
			if( (tmp_id[0] == person)&&(sentiment==all_idea_units[idea]['sentiment'])&&(topic == all_idea_units[idea]['topic']))
			{				
				$("span.idea-unit#"+idea, "#page-2").css("background","");
		
			}//all_idea_units[currentIdeaLists[i].id].visited=true; 
			}
		}
		
	}

}




function showAll(){
	$("div#page-2").hide();
	$(".feedback-cell","div#all-feedback").show();	
	$("div#all-feedback").show();

}


function filterFeedback(){
	SelectFeedback();
	$("div#page-2").show();
	$("div#all-feedback").hide();

}

function addOption(){
   
	$("p[name='check-result']").text("").removeClass();
    var element=$(this);
    element.siblings("#check-result").text("").removeClass();
    var id=element.attr('id');
    //console.log("call addoption",id);
   	var tmptopic = $(this).val();

   	//console.log("new topic", tmptopic, topics.indexOf(tmptopic) );
	/*$.map( $(".feedback-row select[name='topic']:first option"), function (option){
		topics.push(option.value);
	} 
	);*/
   //var options= $(el).parent().children("select option");

  var msg='';
  var status='success';

   if( tmptopic!="")
   {

   		 if( topics.indexOf(tmptopic) == -1){

   		 	var currentid=element.parent().children("select").attr("id");
   			console.log("in if", currentid);

   				topics.push(tmptopic);
   				$(".feedback-row select[name='topic']").each(function(){
    	
					$(this).append( new Option( tmptopic, $('#new-topic').val(), false, false) );
    			//$(this).options[$(this).options.length] = new Option('New Element', '0', false, false);
    			});
   				//console.log(element.parent().children("select").attr("id"));
				element.parent().children("select").val(tmptopic);
				//element.parent().children("select").css('background-color','yellow');
				//$(el).parent().children("select option[value='"+tmptopic+"']").attr('selected','selected');
				all_idea_units[currentid]['topic'] =tmptopic;
	   		 	console.log(JSON.stringify(all_idea_units[currentid]));
	    		//element.siblings("#check-result").text("Successfully added"+).addClass('success');
	    		msg="'"+tmptopic+"' is added!";
	    		status='success';
   				
   		 }else
   		 {
   		 		msg="'"+tmptopic+"' alrady exists!";
   				status='fail';
   		 } 

   		 element.siblings("[name='check-result']").text(msg).addClass(status);
		element.val("");
   		
   }
  
    
}




function finishAnnoate(){

	createTopicArray();
	renderElement();
	renderFactual();

	$('#all-feedback').show();
	$('#page-1').hide();
}


function backAnnotate(){

	$('#page-1').show();
	$('#page-2').hide();
}
//For page 2
    
function createTopicArray()
{
	//all_idea_units=labeled;

	topicArray={};
	//var number_of_idea= Object.keys(all_idea_units).length;
	for (var key in all_idea_units) {
    // check if the property/key is defined in the object itself, not in parent
    //console.log(all_idea_units[key]['topic']);
    var current_topic=all_idea_units[key]['topic'];
    var current_sentiment=all_idea_units[key]['sentiment'];
    //console.log(current_topic,current_sentiment );	
    	if(current_topic!=null && current_sentiment!=0){
	    	if(!(current_topic in topicArray))
	    	{
	    		var currentArray={};
	    		sentimentName.forEach(function(element) {
  					currentArray[element] =new Array();
				});

	    		topicArray[current_topic] = currentArray;
	    	}
	    	topicArray[current_topic][current_sentiment].push(all_idea_units[key]);
	    	//console.log(JSON.stringify(topicArray));
		}


		

    }
}



function print(par)
{
	console.log(par);
}	




function renderElement(){
	
	$("#paneltest").empty();



	for (var topicKey in topicArray) {
		
		var currentTopic=topicArray[topicKey];
		var inser_html="";

		
		inser_html=inser_html+"<tr id='"+topicKey+"'><th scope='row' style='text-align:center;'>"+topicKey+"</th><td>";
		//Render human icons
		inser_html+="<table border='0' class='topic-people'><tr><td></td>";
		var people_id=1;
		for(var index=0; index<number_of_providers;index++)// lopping the topic
		{
			inser_html=inser_html+"<td><span class='fa fa-user human-figure'></span></td>";
				people_id++;
		}
		inser_html+="</tr>";
	
		for (var sentimentKey in currentTopic) {
			
			inser_html+="<tr id='sentiment"+sentimentKey+"'><td width='15%'><b>"+sentimentKey+'</b></td>';
			people_id=1;
			for(var index=0; index<number_of_providers;index++)// lopping the topic
			{
				var currentID=topicKey+'-'+sentimentKey+'-'+people_id;
				var associated_idea_units = getIdeaUnits(topicKey, sentimentKey, people_id).replace('"', '\''); // convert " to '
				if (people_id===3) console.log(associated_idea_units);
				inser_html=inser_html+"<td><div data-toggle='tooltip' title=\""+associated_idea_units+"\" class='tableelement' id='"+currentID+"'></div></td>";
				people_id++;

				visual_status[currentID]=false;
			}
			inser_html+="</tr>";
			
		}
		inser_html+="</table></td></tr>";
		
		$("#paneltest").append(inser_html);
	}

	// enable tooltips
	$('#paneltest div[data-toggle]').tooltip({'html': true});
}

function renderFactual(){

	for (var key in all_idea_units) {
		var people_id=key.split('-');
		//console.log("#"+all_idea_units[key]['topic']+'-'+all_idea_units[key]['sentiment']+'-'+people_id[0]);
		var tmp_sentiment=all_idea_units[key]['sentiment'];
		$("#"+all_idea_units[key]['topic']+'-'+all_idea_units[key]['sentiment']+'-'+people_id[0]).css('background',sentimentColor[tmp_sentiment]);	
	}

}
	




function renderInterpretation(){

	var selectedID=[];
	var numToString=['low','low','low','medium','high','high'];
	
	var checked_effort = [];
	var checked_criticality = [];
	var need_discussion = [];
	var agreement = [];


	$('input[name=effort]:checked').each(function() {checked_effort.push($(this).attr('value'));});
	$('input[name=criticality]:checked').each(function() {checked_criticality.push($(this).attr('value'));});
	$('input[name=discussion]:checked').each(function() {need_discussion.push($(this).attr('value'));});
	$('input[name=agree]:checked').each(function() {agreement.push($(this).attr('value'));});
//if nothing is selected 
if( checked_effort.length > 0 || checked_criticality.length>0 || need_discussion.length>0 || agreement.length>0 )
{


	for (var key in all_idea_units) {
		var people_id=key.split('-')[0];

		var current_topic = all_idea_units[key]['topic'];
		var current_sentiment = all_idea_units[key]['sentiment'];

		var current_effort = all_idea_units[key]['effort'];
		var current_criticality = all_idea_units[key]['criticality'];

		var current_discussion = all_idea_units[key]['discussion'];
		var current_agreement = all_idea_units[key]['agree'];


		if( (checked_effort.length>0 == checked_effort.indexOf(current_effort)>-1) 
			&& (checked_criticality.length>0 == checked_criticality.indexOf(current_criticality)>-1 )
			&& (need_discussion.length>0 == need_discussion.indexOf(current_discussion)>-1 )
			&& (agreement.length>0 == agreement.indexOf(current_agreement)>-1))
		{
			selectedID.push(key);
			$(".tableelement#"+current_topic+'-'+current_sentiment+'-'+people_id+" > span").addClass('highlight');	
		}
		else
		{
			$(".tableelement#"+current_topic+'-'+current_sentiment+'-'+people_id+" > span").removeClass('highlight');	
		}		
	}
	
}else{
	$('.tableelement span').removeClass('highlight');
}

	SelectFeedback(selectedID);

}


</script>